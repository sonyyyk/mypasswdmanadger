{% extends "model.html" %}
{% block title %}Register ‚Äî Password Manager{% endblock %}
{% block content %}
  <h2>Create account</h2>
  <p class="lead">Pick a username and a SUPER secure master password.</p>

  <div style="margin: 15px 0; padding: 15px; background: #fff3cd; border-radius: 8px;">
    <p class="small" style="margin: 0; color: #856404;">
      <strong>üéØ Password Requirements:</strong><br>
      ‚Ä¢ <span id="req-length">üìè At least 16 characters</span><br>
      ‚Ä¢ <span id="req-upper">üî† One uppercase letter</span><br>
      ‚Ä¢ <span id="req-special">‚ö° One special character (!@#$% etc.)</span><br>
      ‚Ä¢ <span id="req-color">üåà Color of the rainbow</span><br>
    </p>
  </div>

  <form class="form" method="post" action="{{ url_for('register') }}" onsubmit="return validatePassword()">
    <!-- üîê CSRF TOKEN - –û–ë–û–í'–Ø–ó–ö–û–í–û –î–û–î–ê–¢–ò -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <div class="form-group">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Choose username" required 
             pattern="[a-zA-Z0-9_]{3,20}" title="3-20 characters, only letters, numbers and underscore">
    </div>
    
    <div class="form-group">
      <label for="master_password">Master Password</label>
      <input type="password" id="master_password" name="master_password" placeholder="Master password" required 
             onkeyup="checkPasswordStrength()" />
    </div>
    
    <div class="form-group">
      <label for="confirm">Confirm Password</label>
      <input type="password" id="confirm" name="confirm" placeholder="Confirm password" required />
    </div>

    <div style="margin: 10px 0;">
      <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Password strength:</div>
      <div style="height: 6px; background: #eee; border-radius: 3px; overflow: hidden;">
        <div id="password-strength-bar" style="height: 100%; width: 0%; background: #ff4444; transition: all 0.3s;"></div>
      </div>
      <div id="password-feedback" style="font-size: 12px; margin-top: 5px;"></div>
    </div>

    <div style="display:flex; gap:10px; width:100%; justify-content:center; margin-top:6px;">
      <button class="btn" type="submit">Register</button>
      <a class="btn secondary" href="{{ url_for('login') }}">Back to login</a>
    </div>
  </form>

  <script>
    function checkPasswordStrength() {
      const password = document.getElementById('master_password').value;
      let strength = 0;
      let feedback = "";
      
      // –ö–æ–ª—å–æ—Ä–∏ –≤–µ—Å–µ–ª–∫–∏
      const rainbowColors = ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'pink', 'violet', 'indigo'];
      
      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–º–æ–≥
      const hasLength = password.length >= 16;
      const hasUpper = /[A-Z]/.test(password);
      const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
      const hasColor = rainbowColors.some(color => password.toLowerCase().includes(color));
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–∫–æ–Ω–æ–∫ –≤–∏–º–æ–≥
      document.getElementById('req-length').style.color = hasLength ? '#28a745' : '#dc3545';
      document.getElementById('req-upper').style.color = hasUpper ? '#28a745' : '#dc3545';
      document.getElementById('req-special').style.color = hasSpecial ? '#28a745' : '#dc3545';
      document.getElementById('req-color').style.color = hasColor ? '#28a745' : '#dc3545';
      
      // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º—ñ—Ü–Ω–æ—Å—Ç—ñ (–∫–æ–∂–µ–Ω –∫—Ä–∏—Ç–µ—Ä—ñ–π = 25%)
      if (hasLength) strength += 25;
      if (hasUpper) strength += 25;
      if (hasSpecial) strength += 25;
      if (hasColor) strength += 25;
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
      const strengthBar = document.getElementById('password-strength-bar');
      const feedbackElement = document.getElementById('password-feedback');
      
      strengthBar.style.width = strength + '%';
      
      // –ö–æ–ª—ñ—Ä —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
      if (strength < 25) {
        strengthBar.style.background = '#ff4444';
        feedback = '‚ùå Very weak password';
      } else if (strength < 50) {
        strengthBar.style.background = '#ffaa00';
        feedback = '‚ö†Ô∏è Weak password';
      } else if (strength < 75) {
        strengthBar.style.background = '#ffdd00';
        feedback = 'üëç Good password';
      } else if (strength < 100) {
        strengthBar.style.background = '#99cc00';
        feedback = 'üí™ Strong password';
      } else {
        strengthBar.style.background = '#00c851';
        feedback = 'üéâ Perfect password!';
      }
      
      feedbackElement.textContent = feedback;
      feedbackElement.style.color = strengthBar.style.background;
    }

    function validatePassword() {
      const password = document.getElementById('master_password').value;
      const confirm = document.getElementById('confirm').value;
      const rainbowColors = ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'pink', 'violet', 'indigo'];
      
      if (password.length < 16) {
        alert('‚ùå Password must be at least 16 characters long');
        return false;
      }
      
      if (!/[A-Z]/.test(password)) {
        alert('‚ùå Password must contain at least one uppercase letter');
        return false;
      }
      
      if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
        alert('‚ùå Password must contain at least one special character');
        return false;
      }
      
      if (!rainbowColors.some(color => password.toLowerCase().includes(color))) {
        alert('‚ùå Password must contain a color of the rainbow (red, orange, yellow, green, blue, purple, pink, violet, indigo)');
        return false;
      }
      
      if (password !== confirm) {
        alert('‚ùå Passwords do not match');
        return false;
      }
      
      return true;
    }
  </script>
{% endblock %}